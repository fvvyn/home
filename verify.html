<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>製品認証</title>
    <!-- Tailwind CSS CDN を読み込み -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* フォント設定 */
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; }
    </style>
</head>
<body>
    <div class="min-h-screen flex items-center justify-center p-4">
        <div id="verification-card" class="w-full max-w-md bg-white shadow-2xl rounded-xl p-8 transition duration-500 ease-in-out">
            
            <header class="text-center mb-6">
                <div class="text-3xl font-extrabold text-gray-800 mb-2">正規品証明</div>
                <p class="text-sm text-gray-500">NFCタグから読み込まれた情報を確認しています</p>
            </header>

            <!-- 認証結果表示エリア -->
            <div id="result-area" class="text-center p-6 rounded-lg">
                <p id="icon" class="text-6xl mb-4">⏱️</p>
                <h2 id="status-title" class="text-2xl font-bold mb-3">認証中です...</h2>
                <p id="status-message" class="text-gray-700">NFCタグの情報を確認しています。しばらくお待ちください。</p>
            </div>

            <!-- 製品情報表示エリア -->
            <div id="product-info" class="mt-8 border-t pt-4 hidden">
                <h3 class="text-lg font-semibold text-gray-700 mb-3">認証された製品詳細です</h3>
                <div class="space-y-2 text-left text-sm">
                    <p><strong>シリアルナンバー:</strong> <span id="display-id" class="font-mono bg-gray-100 p-1 rounded"></span></p>
                    <p><strong>製品名:</strong> <span id="display-name"></span></p>
                    <p><strong>認証時刻:</strong> <span id="display-time"></span></p>
                </div>
            </div>

            <footer class="mt-8 text-xs text-gray-400 text-center">
                <p>Project by fvvyn ©︎</p>
            </footer>
        </div>
    </div>

    <script>
        // GitHub Pagesの制約上、サーバー側のデータベースは使用できません。
        // 代わりに、認証が成功する「有効なシリアルナンバーのリスト」を
        // JavaScriptの定数としてここにハードコードしています。
        // 実際の運用では、このリストを定期的に更新する必要があります。
        const VALID_PRODUCTS = [
            { id: "1A2B3C4D5E6F", name: "ziphoodie" },
            { id: "9876543210ZY", name: "Tshirts" },
            { id: "FGHJ5678WERT", name: "1.α" },
            // 偽造対策として、リストは推測されにくい複雑なIDで構成してください。
        ];

        document.addEventListener('DOMContentLoaded', initializeVerification);

        function getSerialIdFromUrl() {
            // URLから 'id' クエリパラメータを取得
            const urlParams = new URLSearchParams(window.location.search);
            // パスからもシリアルナンバーを読み取る場合は、以下のように記述を拡張できます
            // const pathSegments = window.location.pathname.split('/').filter(s => s);
            return urlParams.get('id');
        }

        function initializeVerification() {
            const serialId = getSerialIdFromUrl();
            const card = document.getElementById('verification-card');
            const resultArea = document.getElementById('result-area');
            const productInfo = document.getElementById('product-info');

            // 1. IDが存在しない場合 (直接アクセスなど)
            if (!serialId) {
                displayError("IDが見つかりません", "URLに有効なシリアルナンバーを含めてください。");
                return;
            }

            // 2. IDをリストで確認
            const foundProduct = VALID_PRODUCTS.find(p => p.id.toUpperCase() === serialId.toUpperCase());

            if (foundProduct) {
                // 認証成功
                displaySuccess(foundProduct, serialId, card, resultArea, productInfo);
            } else {
                // 認証失敗 (偽造または未登録)
                displayError("認証失敗: 未登録のID", `シリアルナンバー ${serialId} は登録されていません。`);
            }
        }

        function displaySuccess(product, serialId, card, resultArea, productInfo) {
            const now = new Date();
            const timeString = now.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' });

            // カードと結果エリアのスタイルを更新 (成功: 緑)
            card.classList.remove('shadow-2xl');
            card.classList.add('border-4', 'border-green-500');
            resultArea.className = 'text-center p-6 rounded-lg bg-green-50';

            // メッセージの更新
            document.getElementById('icon').textContent = '✅';
            document.getElementById('status-title').textContent = '本物証明に成功しました！';
            document.getElementById('status-title').classList.add('text-green-600');
            document.getElementById('status-message').textContent = 'この製品は正規のデータベースに登録されています。';

            // 製品詳細の表示
            document.getElementById('display-id').textContent = product.id;
            document.getElementById('display-name').textContent = product.name;
            document.getElementById('display-time').textContent = timeString;
            productInfo.classList.remove('hidden');
        }

        function displayError(title, message) {
            const resultArea = document.getElementById('result-area');
            
            // エラー時のスタイルを更新 (失敗: 赤)
            resultArea.className = 'text-center p-6 rounded-lg bg-red-50';
            
            // メッセージの更新
            document.getElementById('icon').textContent = '❌';
            document.getElementById('status-title').textContent = title;
            document.getElementById('status-title').classList.add('text-red-600');
            document.getElementById('status-message').textContent = message + ' 製品にご不明な点がある場合は、製造元にお問い合わせください。';
        }

    </script>
</body>
</html>

