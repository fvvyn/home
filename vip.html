<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Membership Access | fvvyn©</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@300;500&family=Noto+Sans+JP:wght@300;400&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        :root { --bg-deep: #050505; --accent-silver: #e5e5e5; --muted-gray: #333333; }
        body, html { background-color: var(--bg-deep); color: #ffffff; font-family: 'Noto Sans JP', sans-serif; overflow: hidden; width: 100%; height: 100%; margin: 0; }
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        #canvas-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
        .content-overlay { position: relative; z-index: 10; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: space-between; align-items: center; padding: 40px 24px; background: radial-gradient(circle at center, transparent 0%, rgba(0,0,0,0.5) 100%); }
        .input-minimal { width: 100%; background: transparent; border: none; border-bottom: 1px solid var(--muted-gray); padding: 12px 0; color: #fff; font-size: 0.85rem; letter-spacing: 0.1em; transition: border-color 0.4s ease; text-align: center; border-radius: 0; }
        .input-minimal:focus { outline: none; border-bottom-color: #fff; }
        .btn-access { background: transparent; border: 1px solid var(--accent-silver); color: var(--accent-silver); padding: 14px 40px; font-size: 0.7rem; letter-spacing: 0.4em; text-transform: uppercase; transition: all 0.5s cubic-bezier(0.19, 1, 0.22, 1); cursor: pointer; margin-top: 40px; width: 100%; max-width: 320px; }
        .btn-access:hover { background: #fff; color: #000; letter-spacing: 0.5em; }
        .consent-wrapper { margin-top: 24px; display: flex; align-items: center; gap: 12px; cursor: pointer; }
        .checkbox-custom { width: 14px; height: 14px; border: 1px solid var(--muted-gray); display: flex; align-items: center; justify-content: center; }
        .checkbox-checked { background-color: #fff; border-color: #fff; }
        .checkbox-checked::after { content: ''; width: 4px; height: 8px; border: solid #000; border-width: 0 1px 1px 0; transform: rotate(45deg); margin-bottom: 2px; }
        #toast { position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%) translateY(20px); opacity: 0; background: #fff; color: #000; padding: 12px 24px; font-size: 0.7rem; letter-spacing: 0.15em; transition: all 0.4s; z-index: 1000; white-space: nowrap; }
        #toast.visible { opacity: 1; transform: translateX(-50%) translateY(0); }
        #toast.warning { background: #ff3b3b; color: #fff; }
        .loader { width: 10px; height: 10px; border: 1px solid rgba(255,255,255,0.2); border-top-color: #fff; border-radius: 50%; animation: spin 0.8s linear infinite; display: inline-block; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="canvas-container"></div>

    <main class="content-overlay">
        <header class="w-full flex justify-between items-center px-4">
            <a href="index.html" class="opacity-60 hover:opacity-100 transition duration-700">
                <img src="fvvyn.png" alt="fvvyn" class="h-5 w-auto grayscale brightness-200">
            </a>
            <div class="text-[9px] tracking-[0.5em] text-zinc-600 font-orbitron uppercase">Access Protocol</div>
        </header>

        <div class="flex flex-col items-center w-full max-w-sm">
            <div class="mb-16 text-center">
                <h1 class="font-orbitron text-[0.65rem] tracking-[0.6em] text-zinc-500 mb-2 uppercase">fvvyn©|VIP</h1>
                <div class="w-6 h-[1px] bg-zinc-800 mx-auto"></div>
            </div>

            <form id="vip-form" class="flex flex-col items-center w-full">
                <div class="w-full max-w-[320px]">
                    <input type="email" id="email-input" placeholder="EMAIL ADDRESS" required class="input-minimal font-orbitron uppercase">
                </div>

                <div class="consent-wrapper" id="consent-trigger">
                    <input type="checkbox" id="consent-check" class="hidden">
                    <div id="checkbox-ui" class="checkbox-custom"></div>
                    <span class="text-[9px] text-zinc-500 tracking-[0.2em] uppercase">I agree to the terms</span>
                </div>

                <button type="submit" id="email-submit-btn" class="btn-access font-orbitron">Entery VIP</button>
            </form>
        </div>

        <footer class="text-[8px] tracking-[0.4em] text-zinc-700 font-orbitron uppercase">fvvyn© Digital Interface v2.0</footer>
    </main>

    <div id="toast"></div>

    <script>
        const GAS_API_URL = "https://script.google.com/macros/s/AKfycbxkCp1qPtSJpTZocwEenWF0lTM8SbvEKjF_hJs5n8W1xiivmjh78Mu4ddALjwAZ137l/exec";
        
        // --- 1. UI LOGIC ---
        const uiCheckbox = document.getElementById('checkbox-ui');
        const realCheckbox = document.getElementById('consent-check');
        const toast = document.getElementById('toast');

        function showToast(msg, isWarning = false) {
            toast.innerText = msg;
            toast.className = isWarning ? 'visible warning' : 'visible';
            setTimeout(() => toast.className = '', 4000);
        }

        document.getElementById('consent-trigger').onclick = () => {
            realCheckbox.checked = !realCheckbox.checked;
            uiCheckbox.classList.toggle('checkbox-checked', realCheckbox.checked);
        };

        // --- 2. FORM SUBMIT ---
        document.getElementById('vip-form').onsubmit = async (e) => {
            e.preventDefault();
            
            // 同意チェックなしのアラート
            if (!realCheckbox.checked) {
                showToast("チェックを入れてください", true);
                return;
            }

            const btn = document.getElementById('email-submit-btn');
            const originalText = btn.innerText;
            btn.innerHTML = '<span class="loader"></span>';
            btn.disabled = true;

            try {
                const response = await fetch(GAS_API_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        type: 'email_signup',
                        email: document.getElementById('email-input').value,
                        consent: true
                    })
                });
                const res = await response.json();

                if (res.status === "exists") {
                    showToast(res.message, true); // 「あなたはすでにVIP会員です」を表示
                    btn.innerText = originalText;
                    btn.disabled = false;
                } else if (res.status === "success") {
                    showToast("SUCCESS. WELCOME TO THE ORDER.");
                    btn.innerText = "ESTABLISHED";
                    setTimeout(() => { window.location.href = "https://fvvyn.stores.jp/"; }, 2000);
                }
            } catch (err) {
                showToast("通信エラーが発生しました。", true);
                btn.innerText = originalText;
                btn.disabled = false;
            }
        };

        // --- 3. THREE.JS (省略版 - 背景の動きを維持) ---
        let scene, camera, renderer, model;
        function initThree() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 6;
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('canvas-container').appendChild(renderer.domElement);
            scene.add(new THREE.AmbientLight(0xffffff, 0.5));
            const geometry = new THREE.IcosahedronGeometry(1.4, 0);
            const material = new THREE.MeshPhysicalMaterial({ color: 0x111111, metalness: 0.9, roughness: 0.1, wireframe: true });
            model = new THREE.Mesh(geometry, material);
            scene.add(model);
            animate();
        }
        function animate() {
            requestAnimationFrame(animate);
            if (model) { model.rotation.y += 0.002; model.position.y = Math.sin(Date.now() * 0.0008) * 0.15; }
            renderer.render(scene, camera);
        }
        window.onload = initThree;
    </script>
</body>
</html>
