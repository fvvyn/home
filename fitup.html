<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FVVYN Drip - Fit Up</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
  <script src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
  <style>
    body { font-family:'Inter', sans-serif; background:#0a0a0a; color:white; }
    .card { border-radius:10px; overflow:hidden; background:rgba(255,255,255,0.05); backdrop-filter:blur(6px); transition: transform .2s; }
    .card:hover { transform:scale(1.03); }
    .share-btn { background:#ff2b6d; color:white; padding:8px 14px; border-radius:8px; font-size:0.9rem; font-weight:600; text-align:center; cursor:pointer; transition: background .2s; }
    .share-btn:hover { background:#ff5c8a; }
    @media (max-width: 1024px) { #user-drip-container { column-count: 2 !important; } }
    @media (max-width: 640px) { #user-drip-container { column-count: 1 !important; } }
  </style>
</head>
<body class="min-h-screen px-4 py-8">
  <h1 class="text-3xl font-bold text-center mb-8 tracking-wide">FVVYN Drip 🔥</h1>
  <div id="user-drip-container" class="mx-auto max-w-6xl" style="column-count: 3; column-gap: 1rem;"></div>

  <script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbyOaHAd_-zKIWDx537Hnjbh5gCkmorJzAbm49B1fAaE3PeOnuTqYnGN3RIcy0SgJlW5Wg/exec";
    const container = document.getElementById("user-drip-container");

    async function loadImages() {
      try {
        const res = await fetch(GAS_URL);
        const data = await res.json();

        container.innerHTML = "";
        data.forEach(item => {
          const card = document.createElement("div");
          card.className = "card mb-4 break-inside-avoid p-2";

          const img = document.createElement("img");
          img.src = item.imageUrl; // プロキシ経由URL
          img.alt = item.username;
          img.className = "w-full rounded-md mb-2";
          img.loading = "lazy";

          const username = document.createElement("p");
          username.textContent = `@${item.username}`;
          username.className = "text-sm text-gray-300 mb-2";

          const shareBtn = document.createElement("button");
          shareBtn.textContent = "ストーリーでシェア 📲";
          shareBtn.className = "share-btn w-full";
          shareBtn.addEventListener("click", () => shareToInstagram(item.imageUrl));

          card.appendChild(img);
          card.appendChild(username);
          card.appendChild(shareBtn);
          container.appendChild(card);
        });

        imagesLoaded(container, () => {
          new Masonry(container, { itemSelector:".card", columnWidth:".card", percentPosition:true, gutter:16 });
        });

      } catch (error) {
        console.error("Error loading images:", error);
        container.innerHTML = "<p class='text-center text-gray-400'>投稿を読み込めませんでした。</p>";
      }
    }

    function shareToInstagram(imageUrl) {
      const encoded = encodeURIComponent(imageUrl);
      const caption = encodeURIComponent("FVVYN Drip 💧 #FVVYN #FitUp");
      const igUrl = `https://www.instagram.com/create/story/?media=${encoded}&caption=${caption}`;
      window.open(igUrl, "_blank");
    }

    loadImages();
  </script>
</body>
</html>
